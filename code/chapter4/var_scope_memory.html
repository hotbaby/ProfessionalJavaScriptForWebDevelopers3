<html>
    <head>
        <title>JavaScript高级程序设计（第3版）</title>
    </head>
    <body>
        <h1>变量、作用域和内存问题</h1>
        <h2>基本类型和引用类型</h2>
        <p>基本类型指的是简单的数据段，而引用类型指的那些由多个值构成的对象。</p>
        <p>Undefined, Null, Boolean, Number, String是基本类型。</p>
        <p>引用类型的值是保存在内存中的对象。JavaScript不允许直接访问内存中的位置，也就是不能直接操作对象的内存空间。</p>

        <h3>动态的属性</h3>
        <script type="text/javascript">
            console.log("\n");
            console.log("动态的属性");

            var person = new Object();
            person.age = 20;
            console.log("person object age attribute:" + person.age);   // 20

            var person = 'Zhangsan';
            person.age = 20;
            console.log("person string age attribute:" + person.age)    // undefined
        </script>

        <h3>复制变量值</h3>
        <script type="text/javascript">
            console.log("\n");
            console.log("复制变量值");

            var num1 = 5;
            var num2 = num1;
            num2 += 10;
            console.log("num1:" + num1 + " num2:" + num2);

            var obj1 = new Object();
            var obj2 = obj1;
            obj1.name = "Nicholas";
            console.log("obj1 name attribute:" + obj1.name, " obj2 name attribute:" + obj2.name);
        </script>

        <h3>传递参数</h3>

        <h3>检测类型</h3>
        <script type="text/javascript">
            var b = true;
            var num = 100;
            var s = "hello world";
            var u;
            var obj = new Object();

            console.log("b type:" + (typeof(b)));
            console.log("num type:" + typeof(num));
            console.log("s type:" + typeof(s));
            console.log("u type:" + typeof(u));
            console.log("obj type:" + typeof(obj));

        </script>

        <h2>执行环境及作用域</h2>
        <p>执行环境(execution context)是Javascript一个重要的概念。执行环境定义变量或函数有权访问的其他数据，决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象(variable object)，环境中定义的多有的变量和函数都保存这个对象中。虽然我们无法范文这个变量，但解释器处理数据时会在后台使用它。</p>
        <p>全局执行环境是最外围的一个执行环境。在Web浏览器中，全局执行环境被认为是window对象，因此所有全局变量和函数都是作为window对象的属性和方法创建的。执行环境的所有代码执行完毕后，该环境被销毁，保存其中所有变量和函数定义也随之销毁。</p>
        <p>每个函数都有自己的执行环境。当执行流进入一个函数时，函数的执行环境被推入一个环境栈中，函数执行之后，栈将其环境弹出，把控制权返回给之前的环境。</p>

        <h3>延长作用域链</h3>
        <script type="text/javascript">
            console.log("\n");
            console.log("延长作用域链：")
            function buildUrl() {
                var qs = "?debug=True";
                with (location) {
                    var url = href + qs;
                }
                return url;
            }
            console.log("url:" + buildUrl());
        </script>

        <h3>没有块级作用域</h3>
        
        <h2>垃圾回收</h2>
        <p>JavaScript具有自动垃圾回收机制，也就是说执行环境负责管理代码执行环境过程中使用的内存。</p>

        <h3>标记清除</h3>
        <h3>引用计数</h3>
        <h3>性能问题</h3> 
        <h3>管理内存</h3>

        <h2>小结</h2>
    </body>
</html>